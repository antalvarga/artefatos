SELECT COUNT (COD_MATRICULA) 
FROM (
      SELECT DISTINCT AC.COD_MATRICULA,AC.NUM_SEQ_ALUNO,ACET.NUM_SEQ_ACORDO_ESPECIAL, CAR2.NUM_SEQ_CARNE NSEQ_CARNE_ORIG,CAR2.VAL_A_PAGAR VAL_A_PAGAR_ORIG, AC.NUM_SEQ_ALUNO_CURSO,
           AC.NUM_SEQ_CANDIDATO,DM.COD_MOEDA,PA.DT_INI_PERIODO, CAR2.DT_MES_ANO_COMPETENCIA, AC.COD_SITUACAO_ALUNO, CAR2.IND_TIPO_CARNE
          FROM sia.ACORDO_ESPECIAL_TITULOS ACET
                ,SIA.DEBITO_MENSALIDADE DM
                ,SIA.DEBITO_CREDITO_CONSUMIDO DCC
                ,SIA.CARNE CAR
                ,SIA.ALUNO_CURSO AC
                ,SIA.ACORDO_ESPECIAL ACO
                ,SIA.ACORDO_ESPECIAL_TITULOS AET2
                ,SIA.CARNE CAR2
                ,SIA.PERIODO_ACADEMICO PA
          WHERE ACET.NUM_SEQ_DEBITO_MENSALIDADE = DM.NUM_SEQ_DEBITO_MENSALIDADE
            AND DM.NUM_SEQ_DEBITO_MENSALIDADE = DCC.NUM_SEQ_DEBITO_MENSALIDADE (+)
            AND DCC.NUM_SEQ_CARNE = CAR.NUM_SEQ_CARNE (+)
            AND AET2.NUM_SEQ_ACORDO_ESPECIAL = ACET.NUM_SEQ_ACORDO_ESPECIAL
            AND AET2.IND_RELACAO = 0
            AND CAR2.NUM_SEQ_CARNE = AET2.NUM_SEQ_CARNE
            AND DM.NUM_SEQ_ALUNO_CURSO = AC.NUM_SEQ_ALUNO_CURSO
            AND PA.NUM_SEQ_PERIODO_ACADEMICO = (select SIA.PERIODO_ATUAL_ALUNO(AC.NUM_SEQ_ALUNO_CURSO) FROM DUAL)
            AND ACET.NUM_SEQ_ACORDO_ESPECIAL = ACO.NUM_SEQ_ACORDO_ESPECIAL
           -- AND AC.COD_MATRICULA = '201701002361' --IN ('201809124093','201809166331')--,
            AND ACET.IND_RELACAO = 2
            AND DM.IND_SITUACAO_DEBITO <> '3'
            AND DM.NUM_SEQ_ALUNO_CURSO IS NOT NULL
          AND DM.DT_MES_ANO_REFERENCIA BETWEEN TO_DATE('01/01/2017', 'DD/MM/YYYY') AND TO_DATE('01/12/2030', 'DD/MM/YYYY')
          AND ACO.NUM_SEQ_CONTRATO_PARCELAMENTO IS NULL
          AND ACO.IND_SITUACAO = 8
          AND AC.COD_SITUACAO_ALUNO = 3
          AND EXISTS (SELECT 1
                      FROM SIA.DEBITO_MENSALIDADE DM2
                     INNER JOIN SIA.ACORDO_ESPECIAL_TITULOS AET2 ON AET2.NUM_SEQ_DEBITO_MENSALIDADE = DM2.NUM_SEQ_DEBITO_MENSALIDADE
                      WHERE DM2.NUM_SEQ_ALUNO_CURSO = DM.NUM_SEQ_ALUNO_CURSO
                        AND DM2.COD_MOTIVO_DEBITO = DM.COD_MOTIVO_DEBITO
                        AND DM2.IND_SITUACAO_DEBITO <> '3'
                        AND DM2.DT_MES_ANO_REFERENCIA = DM.DT_MES_ANO_REFERENCIA
                        AND DM2.ROWID < DM.ROWID
                        AND DM2.COD_MOTIVO_DEBITO in (77,78)
                        AND AET2.NUM_SEQ_ACORDO_ESPECIAL = ACET.NUM_SEQ_ACORDO_ESPECIAL
                        )
           AND NOT EXISTS (SELECT 1 FROM SIA.CREDITO_MENSALIDADE CM 
                                  WHERE CM.DT_MES_ANO_REFERENCIA BETWEEN TO_DATE('01/02/2019', 'DD/MM/YYYY') AND TO_DATE('31/08/2019', 'DD/MM/YYYY')
                                  AND CM.COD_MOTIVO_CREDITO = 113
                                  AND CM.NUM_SEQ_ALUNO_CURSO = DM.NUM_SEQ_ALUNO_CURSO 
                          )
                                  
          UNION ALL
         
          SELECT DISTINCT AC.COD_MATRICULA,AC.NUM_SEQ_ALUNO,ACET.NUM_SEQ_ACORDO_ESPECIAL, CAR2.NUM_SEQ_CARNE NSEQ_CARNE_ORIG,CAR2.VAL_A_PAGAR VAL_A_PAGAR_ORIG, AC.NUM_SEQ_ALUNO_CURSO,
           AC.NUM_SEQ_CANDIDATO,DM.COD_MOEDA,PA.DT_INI_PERIODO, CAR2.DT_MES_ANO_COMPETENCIA, AC.COD_SITUACAO_ALUNO, CAR2.IND_TIPO_CARNE
          FROM sia.ACORDO_ESPECIAL_TITULOS ACET
                ,SIA.DEBITO_MENSALIDADE DM
                ,SIA.DEBITO_CREDITO_CONSUMIDO DCC
                ,SIA.CARNE CAR
                ,SIA.ALUNO_CURSO AC
                ,SIA.ACORDO_ESPECIAL ACO
                ,SIA.ACORDO_ESPECIAL_TITULOS AET2
                ,SIA.CARNE CAR2
                ,SIA.PERIODO_ACADEMICO PA
          WHERE ACET.NUM_SEQ_DEBITO_MENSALIDADE = DM.NUM_SEQ_DEBITO_MENSALIDADE
            AND DM.NUM_SEQ_DEBITO_MENSALIDADE = DCC.NUM_SEQ_DEBITO_MENSALIDADE (+)
            AND DCC.NUM_SEQ_CARNE = CAR.NUM_SEQ_CARNE (+)
            AND AET2.NUM_SEQ_ACORDO_ESPECIAL = ACET.NUM_SEQ_ACORDO_ESPECIAL
            AND AET2.IND_RELACAO = 0
            AND CAR2.NUM_SEQ_CARNE = AET2.NUM_SEQ_CARNE
            AND DM.NUM_SEQ_CANDIDATO = AC.NUM_SEQ_CANDIDATO
            AND PA.NUM_SEQ_PERIODO_ACADEMICO = (select SIA.PERIODO_ATUAL_ALUNO(AC.NUM_SEQ_ALUNO_CURSO) FROM DUAL)
           -- AND AC.COD_MATRICULA = '201701002361'-- IN ('201809124093','201809166331')--'201701002361',
            AND ACET.IND_RELACAO = 2
            AND DM.IND_SITUACAO_DEBITO <> '3'
            AND DM.DT_MES_ANO_REFERENCIA BETWEEN TO_DATE('01/01/2017', 'DD/MM/YYYY') AND TO_DATE('01/12/2030', 'DD/MM/YYYY')
            AND ACO.IND_SITUACAO = 8
            AND AC.COD_SITUACAO_ALUNO = 3
            AND EXISTS (SELECT 1
                      FROM SIA.DEBITO_MENSALIDADE DM2
                     INNER JOIN SIA.ACORDO_ESPECIAL_TITULOS AET3 ON AET3.NUM_SEQ_DEBITO_MENSALIDADE = DM2.NUM_SEQ_DEBITO_MENSALIDADE
                      WHERE DM2.NUM_SEQ_CANDIDATO = DM.NUM_SEQ_CANDIDATO
                        AND DM2.COD_MOTIVO_DEBITO = DM.COD_MOTIVO_DEBITO
                        AND DM2.IND_SITUACAO_DEBITO <> '3'
                        AND DM2.DT_MES_ANO_REFERENCIA = DM.DT_MES_ANO_REFERENCIA
                        AND DM2.ROWID < DM.ROWID
                        AND DM2.COD_MOTIVO_DEBITO in (77,78)
                        AND AET3.NUM_SEQ_ACORDO_ESPECIAL = ACET.NUM_SEQ_ACORDO_ESPECIAL
                        )
             AND NOT EXISTS (SELECT 1 FROM SIA.CREDITO_MENSALIDADE CM 
                                  WHERE CM.DT_MES_ANO_REFERENCIA BETWEEN TO_DATE('01/02/2019', 'DD/MM/YYYY') AND TO_DATE('31/08/2019', 'DD/MM/YYYY')
                                  AND CM.COD_MOTIVO_CREDITO = 113
                                  AND CM.NUM_SEQ_CANDIDATO = DM.NUM_SEQ_CANDIDATO 
                          ))